# This script follows Microsoft's direction on work around for Office vulnerability, see link below.
# https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444
New-PSDrive -Name HKCR -PSProvider Registry -Root HKEY_CLASSES_ROOT | Out-Null
$path = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\"
if(!(Test-Path $path)) {
    New-Item -Path $path | Out-Null
}
for($i=0; $i -le 3; $i++) {
    $cp = $path + $i
    if(!(Test-Path $cp)) {
        New-Item -Path $cp | Out-Null
    }
    Remove-ItemProperty -Path $cp -Name "1001" -Force -ErrorAction SilentlyContinue | Out-Null
    Remove-ItemProperty -Path $cp -Name "1004" -Force -ErrorAction SilentlyContinue | Out-Null
    New-ItemProperty -Path $cp -Name "1001" -Value 3 -PropertyType 'DWord' | Out-Null
    New-ItemProperty -Path $cp -Name "1004" -Value 3 -PropertyType 'DWord' | Out-Null
}
$exts = @("docx","doc","docm","rtf")
foreach($ext in $exts) {
    Remove-Item -Path "HKCR:\.$($ext)\ShellEx\{8895b1c6-b41f-4c1c-a562-0d564250836f}" -ErrorAction SilentlyContinue | Out-Null
}